---------
--------- {'load_knn_datastore': False, 'use_knn_datastore': True, 'dstore_fp16': True, 'k': 2, 'probe': 32, 'knn_sim_func': 'do_not_recomp_l2', 'use_gpu_to_search': True, 'move_dstore_to_mem': True, 'no_load_keys': True, 'knn_temperature_type': 'fix', 'knn_temperature_value': 100, 'knn_lambda_temperature_value': 100}
Namespace(adam_betas='(0.9, 0.98)', adam_eps=1e-08, adaptive_input=False, adaptive_softmax_cutoff=None, adaptive_softmax_dropout=0, arch='transformer_wmt_en_de_big', attention_dropout=0.1, avg_k=False, bucket_cap_mb=25, clip_norm=0.0, cpu=False, criterion='label_smoothed_cross_entropy', cross_self_attention=False, data=['/private/home/edunov/wmt19/data/wmt19_en_de_langid_fastbpe/processed/'], ddp_backend='c10d', decoder_attention_heads=16, decoder_embed_dim=1024, decoder_embed_path=None, decoder_ffn_embed_dim=4096, decoder_input_dim=1024, decoder_layerdrop=0, decoder_layers=6, decoder_layers_to_keep=None, decoder_learned_pos=False, decoder_normalize_before=False, decoder_output_dim=1024, device_id=0, distributed_backend='nccl', distributed_init_method='tcp://learnfair0218:12597', distributed_port=12597, distributed_rank=0, distributed_world_size=128, dropout=0.2, dstore_filename=None, dstore_fp16=True, dstore_size=1, encoder_attention_heads=16, encoder_embed_dim=1024, encoder_embed_path=None, encoder_ffn_embed_dim=8192, encoder_layerdrop=0, encoder_layers=6, encoder_layers_to_keep=None, encoder_learned_pos=False, encoder_normalize_before=False, eval_bleu_detok='space', eval_bleu_remove_bpe=None, eval_tokenized_bleu=False, extra_data='/private/home/edunov/wmt19/data/wmt19_en_de_sampling5_ende_1:/private/home/edunov/wmt19/data/wmt19_en_de_sampling5_ende_2:/private/home/edunov/wmt19/data/wmt19_en_de_sampling5_ende_3:/private/home/edunov/wmt19/data/wmt19_en_de_sampling5_ende_4', faiss_index=None, faiss_metric_type=None, fix_batches_to_gpus=False, fp16=True, fp16_init_scale=128, fp16_scale_tolerance=0.0, fp16_scale_window=None, gumbel_softmax_temperature=1, ignore_prefix_size=0, k=2, k_lambda_net_dropout_rate=0.0, k_lambda_net_hid_size=0, keep_interval_updates=15, keep_last_epochs=-1, knn_k_net_dropout_rate=0, knn_k_net_hid_size=0, knn_k_type='fix', knn_lambda_net_hid_size=0, knn_lambda_temperature_value=100, knn_lambda_type='fix', knn_lambda_value=0.5, knn_net_dropout_rate=0.5, knn_sim_func='do_not_recomp_l2', knn_temperature_net_hid_size=0, knn_temperature_type='fix', knn_temperature_value=100, label_count_as_feature=False, label_smoothing=0.1, lazy_load=False, left_pad_source=True, left_pad_target=False, load_knn_datastore=False, log_format='simple', log_interval=100, lr=[0.0007], lr_scheduler='inverse_sqrt', lr_shrink=0.1, max_epoch=0, max_k=None, max_sentences=None, max_sentences_valid=None, max_source_positions=1024, max_target_positions=1024, max_tokens=3584, max_update=200000, memory_efficient_fp16=False, min_loss_scale=0.0001, min_lr=1e-09, momentum=0.99, move_dstore_to_mem=True, no_cross_attention=False, no_epoch_checkpoints=False, no_load_keys=True, no_progress_bar=True, no_save=False, no_token_positional_embeddings=False, num_batch_buckets=0, num_workers=0, only_train_knn_parameter=False, only_use_max_idx=False, optimizer='adam', optimizer_overrides='{}', probe=32, quant_noise_pq=0, quant_noise_pq_block_size=8, quant_noise_scalar=0, raw_text=False, relative_label_count=False, relu_dropout=0.0, reset_lr_scheduler=False, reset_optimizer=False, restore_file='checkpoint_last.pt', save_dir='/checkpoint/michaelauli/20190403/wmt19de2en.btsample5.ffn8192.transformer_wmt_en_de_big_bsz3584_lr0.0007_dr0.2_size_updates200000_seed2_lbsm0.1_size_sa1_upsample4', save_interval=1, save_interval_updates=1000, seed=2, sentence_avg=False, share_all_embeddings=True, share_decoder_input_output_embed=True, skip_invalid_size_inputs_valid_test=False, source_lang='de', target_lang='en', task='translation', tensorboard_logdir='', threshold_loss_scale=None, train_subset='train', truncate_source=False, update_freq=[1], upsample_primary=4, use_faiss_to_search=False, use_gpu_to_search=True, use_knn_datastore=True, use_old_adam=False, use_weights=False, user_dir=None, valid_subset='valid', validate_interval=1, warmup_init_lr=1e-07, warmup_updates=4000, weight_decay=0.0)
-----------------knn load part of model-----------------
Translated 2000 sentences (54692 tokens) in 66.2s (30.22 sentences/s, 826.31 tokens/s)
Generate test with beam=4: BLEU = 55.10 74.7/61.2/53.2/47.2 (BP = 0.946 ratio = 0.948 hyp_len = 37013 ref_len = 39049)
---------
--------- {'load_knn_datastore': False, 'use_knn_datastore': True, 'dstore_fp16': True, 'k': 2, 'probe': 32, 'knn_sim_func': 'do_not_recomp_l2', 'use_gpu_to_search': True, 'move_dstore_to_mem': True, 'no_load_keys': True, 'knn_temperature_type': 'fix', 'knn_temperature_value': 100, 'knn_lambda_temperature_value': 100}
Namespace(adam_betas='(0.9, 0.98)', adam_eps=1e-08, adaptive_input=False, adaptive_softmax_cutoff=None, adaptive_softmax_dropout=0, arch='transformer_wmt_en_de_big', attention_dropout=0.1, avg_k=False, bucket_cap_mb=25, clip_norm=0.0, cpu=False, criterion='label_smoothed_cross_entropy', cross_self_attention=False, data=['/private/home/edunov/wmt19/data/wmt19_en_de_langid_fastbpe/processed/'], ddp_backend='c10d', decoder_attention_heads=16, decoder_embed_dim=1024, decoder_embed_path=None, decoder_ffn_embed_dim=4096, decoder_input_dim=1024, decoder_layerdrop=0, decoder_layers=6, decoder_layers_to_keep=None, decoder_learned_pos=False, decoder_normalize_before=False, decoder_output_dim=1024, device_id=0, distributed_backend='nccl', distributed_init_method='tcp://learnfair0218:12597', distributed_port=12597, distributed_rank=0, distributed_world_size=128, dropout=0.2, dstore_filename=None, dstore_fp16=True, dstore_size=1, encoder_attention_heads=16, encoder_embed_dim=1024, encoder_embed_path=None, encoder_ffn_embed_dim=8192, encoder_layerdrop=0, encoder_layers=6, encoder_layers_to_keep=None, encoder_learned_pos=False, encoder_normalize_before=False, eval_bleu_detok='space', eval_bleu_remove_bpe=None, eval_tokenized_bleu=False, extra_data='/private/home/edunov/wmt19/data/wmt19_en_de_sampling5_ende_1:/private/home/edunov/wmt19/data/wmt19_en_de_sampling5_ende_2:/private/home/edunov/wmt19/data/wmt19_en_de_sampling5_ende_3:/private/home/edunov/wmt19/data/wmt19_en_de_sampling5_ende_4', faiss_index=None, faiss_metric_type=None, fix_batches_to_gpus=False, fp16=True, fp16_init_scale=128, fp16_scale_tolerance=0.0, fp16_scale_window=None, gumbel_softmax_temperature=1, ignore_prefix_size=0, k=2, k_lambda_net_dropout_rate=0.0, k_lambda_net_hid_size=0, keep_interval_updates=15, keep_last_epochs=-1, knn_k_net_dropout_rate=0, knn_k_net_hid_size=0, knn_k_type='fix', knn_lambda_net_hid_size=0, knn_lambda_temperature_value=100, knn_lambda_type='fix', knn_lambda_value=0.5, knn_net_dropout_rate=0.5, knn_sim_func='do_not_recomp_l2', knn_temperature_net_hid_size=0, knn_temperature_type='fix', knn_temperature_value=100, label_count_as_feature=False, label_smoothing=0.1, lazy_load=False, left_pad_source=True, left_pad_target=False, load_knn_datastore=False, log_format='simple', log_interval=100, lr=[0.0007], lr_scheduler='inverse_sqrt', lr_shrink=0.1, max_epoch=0, max_k=None, max_sentences=None, max_sentences_valid=None, max_source_positions=1024, max_target_positions=1024, max_tokens=3584, max_update=200000, memory_efficient_fp16=False, min_loss_scale=0.0001, min_lr=1e-09, momentum=0.99, move_dstore_to_mem=True, no_cross_attention=False, no_epoch_checkpoints=False, no_load_keys=True, no_progress_bar=True, no_save=False, no_token_positional_embeddings=False, num_batch_buckets=0, num_workers=0, only_train_knn_parameter=False, only_use_max_idx=False, optimizer='adam', optimizer_overrides='{}', probe=32, quant_noise_pq=0, quant_noise_pq_block_size=8, quant_noise_scalar=0, raw_text=False, relative_label_count=False, relu_dropout=0.0, reset_lr_scheduler=False, reset_optimizer=False, restore_file='checkpoint_last.pt', save_dir='/checkpoint/michaelauli/20190403/wmt19de2en.btsample5.ffn8192.transformer_wmt_en_de_big_bsz3584_lr0.0007_dr0.2_size_updates200000_seed2_lbsm0.1_size_sa1_upsample4', save_interval=1, save_interval_updates=1000, seed=2, sentence_avg=False, share_all_embeddings=True, share_decoder_input_output_embed=True, skip_invalid_size_inputs_valid_test=False, source_lang='de', target_lang='en', task='translation', tensorboard_logdir='', threshold_loss_scale=None, train_subset='train', truncate_source=False, update_freq=[1], upsample_primary=4, use_faiss_to_search=False, use_gpu_to_search=True, use_knn_datastore=True, use_old_adam=False, use_weights=False, user_dir=None, valid_subset='valid', validate_interval=1, warmup_init_lr=1e-07, warmup_updates=4000, weight_decay=0.0)
-----------------knn load part of model-----------------
Translated 2000 sentences (54660 tokens) in 76.9s (26.02 sentences/s, 711.11 tokens/s)
Generate test with beam=4: BLEU = 55.39 75.1/61.8/53.8/47.9 (BP = 0.942 ratio = 0.944 hyp_len = 36843 ref_len = 39049)
---------
--------- {'load_knn_datastore': False, 'use_knn_datastore': True, 'dstore_fp16': True, 'k': 2, 'probe': 32, 'knn_sim_func': 'do_not_recomp_l2', 'use_gpu_to_search': True, 'move_dstore_to_mem': True, 'no_load_keys': True, 'knn_temperature_type': 'fix', 'knn_temperature_value': 100, 'knn_lambda_temperature_value': 100}
Namespace(adam_betas='(0.9, 0.98)', adam_eps=1e-08, adaptive_input=False, adaptive_softmax_cutoff=None, adaptive_softmax_dropout=0, arch='transformer_wmt_en_de_big', attention_dropout=0.1, avg_k=False, bucket_cap_mb=25, clip_norm=0.0, cpu=False, criterion='label_smoothed_cross_entropy', cross_self_attention=False, data=['/private/home/edunov/wmt19/data/wmt19_en_de_langid_fastbpe/processed/'], ddp_backend='c10d', decoder_attention_heads=16, decoder_embed_dim=1024, decoder_embed_path=None, decoder_ffn_embed_dim=4096, decoder_input_dim=1024, decoder_layerdrop=0, decoder_layers=6, decoder_layers_to_keep=None, decoder_learned_pos=False, decoder_normalize_before=False, decoder_output_dim=1024, device_id=0, distributed_backend='nccl', distributed_init_method='tcp://learnfair0218:12597', distributed_port=12597, distributed_rank=0, distributed_world_size=128, dropout=0.2, dstore_filename=None, dstore_fp16=True, dstore_size=1, encoder_attention_heads=16, encoder_embed_dim=1024, encoder_embed_path=None, encoder_ffn_embed_dim=8192, encoder_layerdrop=0, encoder_layers=6, encoder_layers_to_keep=None, encoder_learned_pos=False, encoder_normalize_before=False, eval_bleu_detok='space', eval_bleu_remove_bpe=None, eval_tokenized_bleu=False, extra_data='/private/home/edunov/wmt19/data/wmt19_en_de_sampling5_ende_1:/private/home/edunov/wmt19/data/wmt19_en_de_sampling5_ende_2:/private/home/edunov/wmt19/data/wmt19_en_de_sampling5_ende_3:/private/home/edunov/wmt19/data/wmt19_en_de_sampling5_ende_4', faiss_index=None, faiss_metric_type=None, fix_batches_to_gpus=False, fp16=True, fp16_init_scale=128, fp16_scale_tolerance=0.0, fp16_scale_window=None, gumbel_softmax_temperature=1, ignore_prefix_size=0, k=2, k_lambda_net_dropout_rate=0.0, k_lambda_net_hid_size=0, keep_interval_updates=15, keep_last_epochs=-1, knn_k_net_dropout_rate=0, knn_k_net_hid_size=0, knn_k_type='fix', knn_lambda_net_hid_size=0, knn_lambda_temperature_value=100, knn_lambda_type='fix', knn_lambda_value=0.5, knn_net_dropout_rate=0.5, knn_sim_func='do_not_recomp_l2', knn_temperature_net_hid_size=0, knn_temperature_type='fix', knn_temperature_value=100, label_count_as_feature=False, label_smoothing=0.1, lazy_load=False, left_pad_source=True, left_pad_target=False, load_knn_datastore=False, log_format='simple', log_interval=100, lr=[0.0007], lr_scheduler='inverse_sqrt', lr_shrink=0.1, max_epoch=0, max_k=None, max_sentences=None, max_sentences_valid=None, max_source_positions=1024, max_target_positions=1024, max_tokens=3584, max_update=200000, memory_efficient_fp16=False, min_loss_scale=0.0001, min_lr=1e-09, momentum=0.99, move_dstore_to_mem=True, no_cross_attention=False, no_epoch_checkpoints=False, no_load_keys=True, no_progress_bar=True, no_save=False, no_token_positional_embeddings=False, num_batch_buckets=0, num_workers=0, only_train_knn_parameter=False, only_use_max_idx=False, optimizer='adam', optimizer_overrides='{}', probe=32, quant_noise_pq=0, quant_noise_pq_block_size=8, quant_noise_scalar=0, raw_text=False, relative_label_count=False, relu_dropout=0.0, reset_lr_scheduler=False, reset_optimizer=False, restore_file='checkpoint_last.pt', save_dir='/checkpoint/michaelauli/20190403/wmt19de2en.btsample5.ffn8192.transformer_wmt_en_de_big_bsz3584_lr0.0007_dr0.2_size_updates200000_seed2_lbsm0.1_size_sa1_upsample4', save_interval=1, save_interval_updates=1000, seed=2, sentence_avg=False, share_all_embeddings=True, share_decoder_input_output_embed=True, skip_invalid_size_inputs_valid_test=False, source_lang='de', target_lang='en', task='translation', tensorboard_logdir='', threshold_loss_scale=None, train_subset='train', truncate_source=False, update_freq=[1], upsample_primary=4, use_faiss_to_search=False, use_gpu_to_search=True, use_knn_datastore=True, use_old_adam=False, use_weights=False, user_dir=None, valid_subset='valid', validate_interval=1, warmup_init_lr=1e-07, warmup_updates=4000, weight_decay=0.0)
-----------------knn load part of model-----------------
Translated 2000 sentences (54866 tokens) in 105.2s (19.01 sentences/s, 521.61 tokens/s)
Generate test with beam=4: BLEU = 55.35 75.0/61.6/53.5/47.6 (BP = 0.946 ratio = 0.947 hyp_len = 36979 ref_len = 39049)
---------
--------- {'load_knn_datastore': False, 'use_knn_datastore': True, 'dstore_fp16': True, 'k': 2, 'probe': 32, 'knn_sim_func': 'do_not_recomp_l2', 'use_gpu_to_search': True, 'move_dstore_to_mem': True, 'no_load_keys': True, 'knn_temperature_type': 'fix', 'knn_temperature_value': 100, 'knn_lambda_temperature_value': 100}
Namespace(adam_betas='(0.9, 0.98)', adam_eps=1e-08, adaptive_input=False, adaptive_softmax_cutoff=None, adaptive_softmax_dropout=0, arch='transformer_wmt_en_de_big', attention_dropout=0.1, avg_k=False, bucket_cap_mb=25, clip_norm=0.0, cpu=False, criterion='label_smoothed_cross_entropy', cross_self_attention=False, data=['/private/home/edunov/wmt19/data/wmt19_en_de_langid_fastbpe/processed/'], ddp_backend='c10d', decoder_attention_heads=16, decoder_embed_dim=1024, decoder_embed_path=None, decoder_ffn_embed_dim=4096, decoder_input_dim=1024, decoder_layerdrop=0, decoder_layers=6, decoder_layers_to_keep=None, decoder_learned_pos=False, decoder_normalize_before=False, decoder_output_dim=1024, device_id=0, distributed_backend='nccl', distributed_init_method='tcp://learnfair0218:12597', distributed_port=12597, distributed_rank=0, distributed_world_size=128, dropout=0.2, dstore_filename=None, dstore_fp16=True, dstore_size=1, encoder_attention_heads=16, encoder_embed_dim=1024, encoder_embed_path=None, encoder_ffn_embed_dim=8192, encoder_layerdrop=0, encoder_layers=6, encoder_layers_to_keep=None, encoder_learned_pos=False, encoder_normalize_before=False, eval_bleu_detok='space', eval_bleu_remove_bpe=None, eval_tokenized_bleu=False, extra_data='/private/home/edunov/wmt19/data/wmt19_en_de_sampling5_ende_1:/private/home/edunov/wmt19/data/wmt19_en_de_sampling5_ende_2:/private/home/edunov/wmt19/data/wmt19_en_de_sampling5_ende_3:/private/home/edunov/wmt19/data/wmt19_en_de_sampling5_ende_4', faiss_index=None, faiss_metric_type=None, fix_batches_to_gpus=False, fp16=True, fp16_init_scale=128, fp16_scale_tolerance=0.0, fp16_scale_window=None, gumbel_softmax_temperature=1, ignore_prefix_size=0, k=2, k_lambda_net_dropout_rate=0.0, k_lambda_net_hid_size=0, keep_interval_updates=15, keep_last_epochs=-1, knn_k_net_dropout_rate=0, knn_k_net_hid_size=0, knn_k_type='fix', knn_lambda_net_hid_size=0, knn_lambda_temperature_value=100, knn_lambda_type='fix', knn_lambda_value=0.5, knn_net_dropout_rate=0.5, knn_sim_func='do_not_recomp_l2', knn_temperature_net_hid_size=0, knn_temperature_type='fix', knn_temperature_value=100, label_count_as_feature=False, label_smoothing=0.1, lazy_load=False, left_pad_source=True, left_pad_target=False, load_knn_datastore=False, log_format='simple', log_interval=100, lr=[0.0007], lr_scheduler='inverse_sqrt', lr_shrink=0.1, max_epoch=0, max_k=None, max_sentences=None, max_sentences_valid=None, max_source_positions=1024, max_target_positions=1024, max_tokens=3584, max_update=200000, memory_efficient_fp16=False, min_loss_scale=0.0001, min_lr=1e-09, momentum=0.99, move_dstore_to_mem=True, no_cross_attention=False, no_epoch_checkpoints=False, no_load_keys=True, no_progress_bar=True, no_save=False, no_token_positional_embeddings=False, num_batch_buckets=0, num_workers=0, only_train_knn_parameter=False, only_use_max_idx=False, optimizer='adam', optimizer_overrides='{}', probe=32, quant_noise_pq=0, quant_noise_pq_block_size=8, quant_noise_scalar=0, raw_text=False, relative_label_count=False, relu_dropout=0.0, reset_lr_scheduler=False, reset_optimizer=False, restore_file='checkpoint_last.pt', save_dir='/checkpoint/michaelauli/20190403/wmt19de2en.btsample5.ffn8192.transformer_wmt_en_de_big_bsz3584_lr0.0007_dr0.2_size_updates200000_seed2_lbsm0.1_size_sa1_upsample4', save_interval=1, save_interval_updates=1000, seed=2, sentence_avg=False, share_all_embeddings=True, share_decoder_input_output_embed=True, skip_invalid_size_inputs_valid_test=False, source_lang='de', target_lang='en', task='translation', tensorboard_logdir='', threshold_loss_scale=None, train_subset='train', truncate_source=False, update_freq=[1], upsample_primary=4, use_faiss_to_search=False, use_gpu_to_search=True, use_knn_datastore=True, use_old_adam=False, use_weights=False, user_dir=None, valid_subset='valid', validate_interval=1, warmup_init_lr=1e-07, warmup_updates=4000, weight_decay=0.0)
-----------------knn load part of model-----------------
Translated 2000 sentences (54961 tokens) in 172.5s (11.60 sentences/s, 318.66 tokens/s)
Generate test with beam=4: BLEU = 55.45 74.8/61.4/53.4/47.5 (BP = 0.949 ratio = 0.950 hyp_len = 37094 ref_len = 39049)
---------
--------- {'load_knn_datastore': False, 'use_knn_datastore': True, 'dstore_fp16': True, 'k': 2, 'probe': 32, 'knn_sim_func': 'do_not_recomp_l2', 'use_gpu_to_search': True, 'move_dstore_to_mem': True, 'no_load_keys': True, 'knn_temperature_type': 'fix', 'knn_temperature_value': 100, 'knn_lambda_temperature_value': 100}
Namespace(adam_betas='(0.9, 0.98)', adam_eps=1e-08, adaptive_input=False, adaptive_softmax_cutoff=None, adaptive_softmax_dropout=0, arch='transformer_wmt_en_de_big', attention_dropout=0.1, avg_k=False, bucket_cap_mb=25, clip_norm=0.0, cpu=False, criterion='label_smoothed_cross_entropy', cross_self_attention=False, data=['/private/home/edunov/wmt19/data/wmt19_en_de_langid_fastbpe/processed/'], ddp_backend='c10d', decoder_attention_heads=16, decoder_embed_dim=1024, decoder_embed_path=None, decoder_ffn_embed_dim=4096, decoder_input_dim=1024, decoder_layerdrop=0, decoder_layers=6, decoder_layers_to_keep=None, decoder_learned_pos=False, decoder_normalize_before=False, decoder_output_dim=1024, device_id=0, distributed_backend='nccl', distributed_init_method='tcp://learnfair0218:12597', distributed_port=12597, distributed_rank=0, distributed_world_size=128, dropout=0.2, dstore_filename=None, dstore_fp16=True, dstore_size=1, encoder_attention_heads=16, encoder_embed_dim=1024, encoder_embed_path=None, encoder_ffn_embed_dim=8192, encoder_layerdrop=0, encoder_layers=6, encoder_layers_to_keep=None, encoder_learned_pos=False, encoder_normalize_before=False, eval_bleu_detok='space', eval_bleu_remove_bpe=None, eval_tokenized_bleu=False, extra_data='/private/home/edunov/wmt19/data/wmt19_en_de_sampling5_ende_1:/private/home/edunov/wmt19/data/wmt19_en_de_sampling5_ende_2:/private/home/edunov/wmt19/data/wmt19_en_de_sampling5_ende_3:/private/home/edunov/wmt19/data/wmt19_en_de_sampling5_ende_4', faiss_index=None, faiss_metric_type=None, fix_batches_to_gpus=False, fp16=True, fp16_init_scale=128, fp16_scale_tolerance=0.0, fp16_scale_window=None, gumbel_softmax_temperature=1, ignore_prefix_size=0, k=2, k_lambda_net_dropout_rate=0.0, k_lambda_net_hid_size=0, keep_interval_updates=15, keep_last_epochs=-1, knn_k_net_dropout_rate=0, knn_k_net_hid_size=0, knn_k_type='fix', knn_lambda_net_hid_size=0, knn_lambda_temperature_value=100, knn_lambda_type='fix', knn_lambda_value=0.5, knn_net_dropout_rate=0.5, knn_sim_func='do_not_recomp_l2', knn_temperature_net_hid_size=0, knn_temperature_type='fix', knn_temperature_value=100, label_count_as_feature=False, label_smoothing=0.1, lazy_load=False, left_pad_source=True, left_pad_target=False, load_knn_datastore=False, log_format='simple', log_interval=100, lr=[0.0007], lr_scheduler='inverse_sqrt', lr_shrink=0.1, max_epoch=0, max_k=None, max_sentences=None, max_sentences_valid=None, max_source_positions=1024, max_target_positions=1024, max_tokens=3584, max_update=200000, memory_efficient_fp16=False, min_loss_scale=0.0001, min_lr=1e-09, momentum=0.99, move_dstore_to_mem=True, no_cross_attention=False, no_epoch_checkpoints=False, no_load_keys=True, no_progress_bar=True, no_save=False, no_token_positional_embeddings=False, num_batch_buckets=0, num_workers=0, only_train_knn_parameter=False, only_use_max_idx=False, optimizer='adam', optimizer_overrides='{}', probe=32, quant_noise_pq=0, quant_noise_pq_block_size=8, quant_noise_scalar=0, raw_text=False, relative_label_count=False, relu_dropout=0.0, reset_lr_scheduler=False, reset_optimizer=False, restore_file='checkpoint_last.pt', save_dir='/checkpoint/michaelauli/20190403/wmt19de2en.btsample5.ffn8192.transformer_wmt_en_de_big_bsz3584_lr0.0007_dr0.2_size_updates200000_seed2_lbsm0.1_size_sa1_upsample4', save_interval=1, save_interval_updates=1000, seed=2, sentence_avg=False, share_all_embeddings=True, share_decoder_input_output_embed=True, skip_invalid_size_inputs_valid_test=False, source_lang='de', target_lang='en', task='translation', tensorboard_logdir='', threshold_loss_scale=None, train_subset='train', truncate_source=False, update_freq=[1], upsample_primary=4, use_faiss_to_search=False, use_gpu_to_search=True, use_knn_datastore=True, use_old_adam=False, use_weights=False, user_dir=None, valid_subset='valid', validate_interval=1, warmup_init_lr=1e-07, warmup_updates=4000, weight_decay=0.0)
-----------------knn load part of model-----------------
Translated 2000 sentences (54287 tokens) in 62.4s (32.05 sentences/s, 869.82 tokens/s)
Generate test with beam=4: BLEU = 54.42 75.0/61.2/52.9/46.8 (BP = 0.937 ratio = 0.939 hyp_len = 36659 ref_len = 39049)
